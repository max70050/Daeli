<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dæli-Gruenwald</title>
    <script src="https://js.stripe.com/v3/"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header class="navbar">
        <div class="nav-container">
            <a href="#" class="nav-logo">
                <img src="logoschulmensa.jpg" alt="dæli Logo">
            </a>
            <button class="hamburger-menu" id="hamburger-menu">
                <span class="hamburger-bar"></span>
                <span class="hamburger-bar"></span>
                <span class="hamburger-bar"></span>
            </button>
            <nav class="nav-links" id="nav-links">
                <a href="#" id="home-link">Startseite</a>
                <a href="#" id="order-link">Vorbestellen</a>
                <a href="#" id="user-orders-link" style="display: none;">Meine Bestellungen</a>
                <a href="#" id="management-orders-link" style="display: none;">Bestellungen</a>
                <a href="#" id="admin-area-link" style="display: none;">Admin</a>
                <a href="#" id="admintools-link" style="display: none;">Admintools</a>
            </nav>
            <div class="nav-user-actions">
                <a href="#" id="user-profile-link" style="display: none;"></a>
                <button class="nav-button" id="auth-button">Anmelden</button>
            </div>
        </div>
    </header>

    <main id="welcome-section" class="welcome-section">
        <div class="welcome-content">
            <h1>Willkommen bei dæli</h1>
            <p><small><strong>Funktioniert im Schul-WLAN nicht immer.</strong></small></p>
            <p>Dein Essen, nur einen Klick entfernt. Bestelle jetzt einfach online vor und spare Zeit in den Pausen.</p>
            <button class="cta-button" id="order-cta-button">Jetzt bestellen</button>
        </div>
    </main>

    <main id="order-section" style="display: none;">
        <div id="favorites-section" class="collapsible-section" style="display: none;">
            <div class="collapsible-header" id="favorites-header">
                <h3><i class="fa-solid fa-star"></i> Deine Favoriten</h3>
                <i class="fa-solid fa-chevron-down toggle-arrow"></i>
            </div>
            <div class="collapsible-content" id="favorites-list">
            </div>
        </div>

        <div class="menu-container">
            <h1>Speisekarte</h1>
            <div id="restverkauf-section" style="display: none;">
                <div class="restverkauf-header">
                    <h2><i class="fa-solid fa-bolt"></i> Freitags-Restverkauf!</h2>
                    <p>Alle Wraps nur 1,50 €! Nur für sofortige Abholung und solange der Vorrat reicht.</p>
                    <p>Nur vor Ort, gegen Barzahlung erhältlich.</p>
                </div>
                <div id="restverkauf-items-container">
                </div>
            </div>
           
          

            <div class="menu-category">
                <h2>Wraps</h2>
                <div class="menu-item" data-id="1" data-name="Halber Schinken Wrap" data-price="3.00">
                    <div class="item-info"><span class="item-name">Halber Schinken Wrap</span><span class="item-price">3,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="2" data-name="Halber Sweet Chili Chicken Wrap" data-price="3.00">
                    <div class="item-info"><span class="item-name">Halber Sweet Chili Chicken Wrap</span><span class="item-price">3,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="3" data-name="Halber Hähnchen Kebab" data-price="3.00">
                    <div class="item-info"><span class="item-name">Halber Hähnchen Kebab Wrap</span><span class="item-price">3,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="4" data-name="Ganzer Schinken Wrap" data-price="6.00">
                    <div class="item-info"><span class="item-name">Ganzer Schinken Wrap</span><span class="item-price">6,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="5" data-name="Ganzer Sweet Chili Chicken Wrap" data-price="6.00">
                    <div class="item-info"><span class="item-name">Ganzer Sweet Chili Chicken Wrap</span><span class="item-price">6,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="6" data-name="Ganzer Hähnchen Kebab" data-price="6.00">
                    <div class="item-info"><span class="item-name">Ganzer Hähnchen Kebab Wrap</span><span class="item-price">6,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
            </div>

            <div class="menu-category">
                <h2>Pizzen</h2>
                <div class="menu-item" data-id="7" data-name="Viertel Pizza Margherita" data-price="2.50">
                    <div class="item-info"><span class="item-name">Viertel Pizza Margherita</span><span class="item-price">2,50 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="8" data-name="Viertel Pizza Diavolo" data-price="2.50">
                    <div class="item-info"><span class="item-name">Viertel Pizza Diavolo</span><span class="item-price">2,50 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="9" data-name="Viertel Pizza Thunfisch" data-price="2.50">
                    <div class="item-info"><span class="item-name">Viertel Pizza Thunfisch</span><span class="item-price">2,50 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="10" data-name="Viertel Pizza Funghi" data-price="2.50">
                    <div class="item-info"><span class="item-name">Viertel Pizza Funghi</span><span class="item-price">2,50 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="11" data-name="Halbe Pizza Margherita" data-price="4.00">
                    <div class="item-info"><span class="item-name">Halbe Pizza Margherita</span><span class="item-price">4,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="12" data-name="Halbe Pizza Diavolo" data-price="4.00">
                    <div class="item-info"><span class="item-name">Halbe Pizza Diavolo</span><span class="item-price">4,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="13" data-name="Halbe Pizza Thunfisch" data-price="4.00">
                    <div class="item-info"><span class="item-name">Halbe Pizza Thunfisch</span><span class="item-price">4,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="14" data-name="Halbe Pizza Funghi" data-price="4.00">
                    <div class="item-info"><span class="item-name">Halbe Pizza Funghi</span><span class="item-price">4,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="15" data-name="Ganze Pizza Margherita" data-price="8.00">
                    <div class="item-info"><span class="item-name">Ganze Pizza Margherita</span><span class="item-price">8,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="16" data-name="Ganze Pizza Diavolo" data-price="8.00">
                    <div class="item-info"><span class="item-name">Ganze Pizza Diavolo</span><span class="item-price">8,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="17" data-name="Ganze Pizza Thunfisch" data-price="8.00">
                    <div class="item-info"><span class="item-name">Ganze Pizza Thunfisch</span><span class="item-price">8,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="18" data-name="Ganze Pizza Funghi" data-price="8.00">
                    <div class="item-info"><span class="item-name">Ganze Pizza Funghi</span><span class="item-price">8,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
            </div>

            <div class="menu-category">
                <h2>Focaccias</h2>
                <div class="menu-item" data-id="19" data-name="Mozzarella Focaccia" data-price="4.00">
                    <div class="item-info"><span class="item-name">Focaccia Mozzarella</span><span class="item-price">4,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="20" data-name="Veggi Love Focaccia" data-price="4.00">
                    <div class="item-info"><span class="item-name">Focaccai Veggie Love</span><span class="item-price">4,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
            </div>
            
            <div class="menu-category">
                <h2>Flammkuchen</h2>
                <div class="menu-item" data-id="21" data-name="Halber Flammkuchen Traditionell" data-price="3.50">
                    <div class="item-info"><span class="item-name">Halber Flammkuchen Traditionell</span><span class="item-price">3,50 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="22" data-name="Halber Flammkuchen Mediterran" data-price="3.50">
                    <div class="item-info"><span class="item-name">Halber Flammkuchen Mediterran</span><span class="item-price">3,50 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="23" data-name="Ganzer Flammkuchen Traditionell" data-price="6.00">
                    <div class="item-info"><span class="item-name">Ganzer Flammkuchen Traditionell</span><span class="item-price">6,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
                <div class="menu-item" data-id="24" data-name="Ganzer Flammkuchen Mediterran" data-price="6.00">
                    <div class="item-info"><span class="item-name">Ganzer Flammkuchen Mediterran</span><span class="item-price">6,00 €</span></div>
                    <div class="item-actions">
                        <button class="favorite-btn"><i class="fa-regular fa-star"></i></button>
                        <div class="quantity-selector"><button class="quantity-btn minus-btn">-</button><span class="quantity">0</span><button class="quantity-btn plus-btn">+</button></div>
                    </div>
                </div>
            </div>

        </div>

        <div class="cart-container">
            <h2>Warenkorb</h2>
           <p><strong>Bald verfügbar</strong></p>
            </div>
        </div>
         <div class="pdf-menu-link-container">
                <p>Hier findest du unsere vollständige Speisekarte mit allen Snacks und Getränken, die du direkt vor Ort kaufen kannst. Außerdem findest du hier auch alle Infos zu Allergen und Zusatzstoffen.</p>
                <a href="./speisekarte.pdf" target="_blank" class="cta-button secondary-button">
                    <i class="fa-solid fa-file-pdf"></i>
                    Vollständige Speisekarte ansehen
                </a>
            </div>

    </main>
    
    <main id="profile-section" style="display: none;">
        <div class="profile-container">
            <h1>Profileinstellungen</h1>
 <div class="profile-card" id="verification-card">
                <h2>Konto verifizieren</h2> <br>
<p>Passende Codes bekommst du bei Victor aus der 9A </p>
                <div class="profile-field">
                    <label for="verification-pin">Verifizierungs-PIN</label>
                    <input type="text" id="verification-pin" placeholder="8-stelligen PIN eingeben" maxlength="8">
                    <small>Um die Plattform nutzen zu können, musst du dein Konto mit dem von der Schule bereitgestellten PIN verifizieren. Dies stellt sicher, dass nur Schüler ab der 8. Klasse bestellen können.</small>
                </div>
                <button id="verify-account-btn" class="cta-button">
                    <span class="btn-text">Verifizieren</span>
                    <span class="btn-spinner"></span>
                </button>
            </div>
            <div class="profile-card">
                <h2>Kontoinformationen</h2>
                <div class="profile-field">
                    <label for="profile-email">E-Mail-Adresse</label>
                    <input type="email" id="profile-email" disabled>
                </div>
                <div class="profile-field">
                    <label for="profile-password">Passwort</label>
                    <div class="password-display-wrapper">
                        <input type="password" id="profile-password" value="••••••••••" disabled>
                        <button id="reset-password-btn" class="secondary-button">Passwort zurücksetzen</button>
                    </div>
                </div>
            </div>

            <div class="profile-card" id="verification-status-display" style="display: none;">
            </div>

           

            <div class="profile-card">
                <h2>Benutzerprofil</h2>
                <div class="profile-field">
                    <label for="profile-username">Benutzername</label>
                    <input type="text" id="profile-username" placeholder="Dein Benutzername" maxlength="15" minlength="5">
                    <div id="username-profile-error" class="error-message" style="display: none; color: var(--error); font-size: 13px; margin-top: 5px;"></div>
                    <small id="username-limit-info">Kann 2 Mal pro Monat geändert werden.</small>
                </div>
                <div class="profile-field">
                    <label for="profile-firstname">Vorname</label>
                    <input type="text" id="profile-firstname" placeholder="Dein Vorname" maxlength="15" minlength="3">
                    <div id="firstname-profile-error" class="error-message" style="display: none; color: var(--error); font-size: 13px; margin-top: 5px;"></div>
                </div>
                <div class="profile-field">
                    <label for="profile-lastname">Nachname</label>
                    <input type="text" id="profile-lastname" placeholder="Dein Nachname" maxlength="15" minlength="2">
                    <div id="lastname-profile-error" class="error-message" style="display: none; color: var(--error); font-size: 13px; margin-top: 5px;"></div>
                    <small id="fullname-limit-info">Vor- und Nachname können insgesamt nur 2 Mal geändert werden.</small>
                </div>
                <div class="profile-button-group">
                    <button id="save-profile-btn" class="cta-button">
                        <span class="btn-text">Profil speichern</span>
                        <span class="btn-spinner"></span>
                    </button>
                    <button id="discard-profile-btn" class="secondary-button">Verwerfen</button>
                </div>
            </div>
            
            <div class="profile-card">
                <h2>Darstellung</h2>
                <p class="theme-switcher-description">Wähle dein bevorzugtes Farbschema.</p>
                <div class="theme-switcher">
                    <div class="theme-option">
                        <input type="radio" id="theme-light" name="theme" value="light">
                        <label for="theme-light">
                            <i class="fa-solid fa-sun"></i>
                            <span>Hell</span>
                        </label>
                    </div>
                    <div class="theme-option">
                        <input type="radio" id="theme-dark" name="theme" value="dark">
                        <label for="theme-dark">
                            <i class="fa-solid fa-moon"></i>
                            <span>Dunkel</span>
                        </label>
                    </div>
                    <div class="theme-option">
                        <input type="radio" id="theme-system" name="theme" value="system">
                        <label for="theme-system">
                            <i class="fa-solid fa-desktop"></i>
                            <span>System</span>
                        </label>
                    </div>
                </div>
                <br>
                <h2>Guthaben</h2>
                <div class="balance-display">
                    <span>Aktuelles Guthaben:</span>
                    <strong id="profile-balance">0,00 €</strong>
                </div>
                <p class="theme-switcher-description" style="margin-top: -10px; text-align: center;">Zahle mit Guthaben, um die 0,25 € Gebühr bei Bestellungen zu sparen.</p>
                <div class="profile-field topup-field">
                    <label for="topup-amount">Betrag aufladen (€)</label>
                    <input type="number" id="topup-amount" placeholder="z.B. 10" min="5" max="100">
                    <small>Mindestens 5,00 €. Das maximale Guthaben beträgt 100,00 €.<br><strong>Zzgl. 0,25 € Transaktionsgebühr pro Aufladung.</strong></small>
                    <div id="topup-error-message" class="error-message" style="display: none; color: var(--error); font-size: 13px; margin-top: 5px;"></div>
                </div>
                <button id="topup-balance-btn" class="cta-button">
                    <span class="btn-text">Guthaben jetzt aufladen</span>
                    <span class="btn-spinner"></span>
                </button>
                <small class="modal-info-text" style="text-align: center; display: block; margin-top: 10px;">Der Bezahlvorgang kann wegen Server-Aufstartzeiten bis zu einer Minute dauern.</small>
            </div>

            <hr class="profile-separator">
            
            <h3>Konto löschen</h3>
            <br>
            <div class="profile-card danger-zone">
                <p class="danger-zone-text">Wenn du dein Konto löschst, werden alle deine Daten endgültig gelöscht. Dieser Vorgang kann nicht rückgängig gemacht werden.</p>
                <button id="delete-account-btn" class="danger-button">Konto löschen</button>
            </div>
        </div>
    </main>

    <main id="user-orders-section" class="orders-display-section" style="display: none;">
        <div class="orders-container">
            <h1>Deine Bestellungen</h1>
            <div class="order-day-tabs">
                <button data-day="Montag">Montag</button>
                <button data-day="Dienstag">Dienstag</button>
                <button data-day="Mittwoch">Mittwoch</button>
                <button data-day="Donnerstag">Donnerstag</button>
                <button data-day="Freitag">Freitag</button>
            </div>
            <div id="user-orders-list">
                <p>Hier siehst du bald eine Übersicht deiner vergangenen Bestellungen.</p>
            </div>
            
            <hr class="profile-separator">
            
            <div id="archived-orders-section" class="collapsible-section sub-section">
                <div class="collapsible-header" id="archived-orders-header">
                     <h2><i class="fa-solid fa-box-archive"></i> Archivierte Bestellungen (letzte 7 Tage)</h2>
                     <i class="fa-solid fa-chevron-down toggle-arrow"></i>
                </div>
                <div class="collapsible-content" id="archived-orders-list">
                    <p>Hier werden deine als "erhalten" markierten Bestellungen angezeigt.</p>
                </div>
            </div>
        </div>
    </main>

    <main id="management-orders-section" class="orders-display-section" style="display: none;">
        <div class="orders-container">
            <h1>Alle Bestellungen</h1>
            <h4>Eingegangene Bestellungen, nur für Admins sichtbar.</h4>
            <div class="order-day-tabs">
                <button data-day="Montag">Montag</button>
                <button data-day="Dienstag">Dienstag</button>
                <button data-day="Mittwoch">Mittwoch</button>
                <button data-day="Donnerstag">Donnerstag</button>
                <button data-day="Freitag">Freitag</button>
            </div>
            <div id="management-orders-list">
                <p>Hier werden alle eingegangenen Bestellungen für Co-Admins und Admins angezeigt.</p>
            </div>
        </div>
    </main>

    <main id="admin-area-section" class="placeholder-section" style="display: none;">
        <h1>Admin-Bereich</h1>
        <p>Dieser Bereich ist für Administratoren reserviert.</p>
    </main>

    <main id="admintools-section" class="orders-display-section" style="display: none;">
        <div class="orders-container">
            <h1>Admintools</h1>
            
            <div class="stats-container">
                <div class="stat-card">
                    <span class="stat-value" id="stats-user-count">...</span>
                    <span class="stat-label">Registrierte Nutzer</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stats-open-orders-count">...</span>
                    <span class="stat-label">Offene Bestellungen</span>
                </div>
                <div class="stat-card">
                    <span class="stat-value" id="stats-today-orders-count">...</span>
                    <span class="stat-label">Bestellungen heute<br> <small>nicht immer aktuell<mall></span>
                </div>
            </div>

<div class="sub-section">
                <h2>Top Produkte (Letzte 7 Tage)</h2>
                <p>Eine Rangliste der meistverkauften Produkte der letzten 7 Tage.</p>
                <div id="product-leaderboard-container">
                    <p>Lade Ranking...</p>
                </div>
            </div>

            <div class="sub-section">
                <h2>Speisekarte verwalten</h2>
                <p>Markiere Artikel als "Ausverkauft". Diese können dann von Nutzern nicht mehr bestellt werden.</p>
                <div id="admin-menu-container">
                </div>
            </div>

            <div class="sub-section">
                <h2>Restverkauf verwalten (Freitag ab 13 Uhr)</h2>
                <p>Lege hier die Stückzahlen für den Restverkauf fest. Setze die Zahlen am Abend oder Samstag wieder auf 0 zurück.</p>
                <div id="admin-restverkauf-container">
                </div>
                <div class="admin-restverkauf-actions">
                    <button id="reset-restverkauf-btn" class="danger-button">
                        <i class="fa-solid fa-trash"></i> Alle Restbestände zurücksetzen
                    </button>
                </div>
            </div>

        <div class="sub-section">
                <h2>Bestelltage verwalten</h2>
                <p>Sperre einzelne Tage (z.B. Feiertage) für zukünftige Bestellungen. Gesperrte Tage können für Bestellungen nicht ausgewählt werden.</p>
                <div class="user-search-form">
                    <input type="date" id="disable-date-input" style="padding: 12px; border-radius: 10px; border: 1px solid var(--line); font-family: inherit; background: #fafafa; flex-grow: 1;">
                    <button id="disable-date-btn" class="danger-button" style="width: auto; flex-shrink: 0;">Tag sperren</button>
                    <button id="enable-date-btn" class="secondary-button" style="width: auto; flex-shrink: 0;">Tag freigeben</button>
                </div>
                <h3>Aktuell gesperrte Tage:</h3>
                <div id="disabled-days-list">
                    <p>Lade gesperrte Tage...</p>
                </div>
            </div>

            <div class="sub-section user-management-section">
                <h2>Nutzerverwaltung</h2>
                <h3>Nutzer bitte nur <strong>nach Absprache</strong> mit Mäxle sperren!</h3>
                <p>Suche nach Nutzern via exakter E-Mail-Adresse oder Benutzernamen, um deren Profil einzusehen und zu verwalten. Achte auf Groß- und Kleinschreibweise.</p>
                
                <div class="user-search-form">
                    <input type="text" id="user-search-input" placeholder="E-Mail oder Benutzername eingeben...">
                </div>

                <div id="user-search-results">
                </div>
            </div>

            <div class="modal-overlay" id="user-detail-modal" style="display: none;">
                <div class="modal-content">
                </div>
            </div>

            <div class="sub-section">
                <h2>Gemeldete Bestellungen</h2>
                <h3>Nutzer bitte nur <strong>nach Absprache</strong> mit Mäxle sperren!</h3>
                <div id="reported-orders-list">
                    <p>Hier werden gemeldete Bestellungen zur Überprüfung angezeigt.</p>
                </div>
            </div>

<div class="sub-section">
                <h2>Bestellung suchen</h2>
                <p>Suche nach einer bestimmten Bestellung über die 6-stellige Bestellnummer.</p>
                <div class="user-search-form">
                    <input type="text" id="order-search-input" placeholder="Bestellnummer eingeben..." maxlength="6">
                    <button id="order-search-btn" class="cta-button">Suchen</button>
                </div>
                <div id="order-search-results">
                    </div>
            </div>
            

            <div class="sub-section">
                <h2>Bestellungen</h2>
                <p class="danger-zone-text" style="margin-bottom: 15px;">Löscht alle Bestellungen, die älter als 7 Tage sind, endgültig aus der Datenbank, um Speicherplatz frei zu halten.</p>
                <button id="delete-old-orders-btn" class="danger-button">Alte Bestellungen löschen</button>
            </div>
        </div>
    </main>

    <div id="auth-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="close-button">&times;</span>

            <div id="login-view">
                <h2>Anmelden</h2>
                <input type="email" id="login-email" placeholder="E-Mail" maxlength="50">
                <div class="password-wrapper">
                    <input type="password" id="login-password" placeholder="Passwort">
                    <i class="fa-solid fa-eye-slash" id="toggle-login-password"></i>
                </div>
                <br>
                <button id="login-btn">
                    <span class="btn-text">Anmelden</span>
                    <span class="btn-spinner"></span>
                </button>
                <div class="divider">ODER</div>
                <button id="google-signin-btn" class="google-signin-btn">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google Logo">
                    Mit Google anmelden
                </button>
                <p class="toggle-link-text"><a href="#" id="show-password-reset">Passwort vergessen?</a></p>
                <p class="toggle-link-text">Du hast noch kein Konto? <a href="#" id="show-register">Jetzt registrieren</a></p>
            </div>

            <div id="register-view" style="display: none;">
                <h2>Registrieren</h2>
                <input type="text" id="register-username" placeholder="Benutzername" maxlength="15" minlength="5">
                <div id="username-error-message" style="display: none; color: var(--error); text-align: left; font-size: 13px; margin-top: -10px; margin-bottom: 15px;"></div>
                <input type="email" id="register-email" placeholder="E-Mail" maxlength="50">
                <div class="password-wrapper">
                    <input type="password" id="register-password" placeholder="Passwort">
                    <i class="fa-solid fa-eye-slash" id="toggle-register-password"></i>
                </div>
                <div id="password-strength-feedback">
                    <p>Das Passwort muss enthalten:</p>
                    <ul>
                        <li id="length-check">Mindestens 8 Zeichen</li>
                        <li id="uppercase-check">Mindestens einen Großbuchstaben</li>
                        <li id="number-check">Mindestens eine Zahl</li>
                    </ul>
                </div>
                
                <div style="text-align: left; margin-bottom: 20px; font-size: 13px; color: #666;">
                    <input type="checkbox" id="agb-checkbox" style="width: auto; margin-right: 8px; vertical-align: middle;">
                    <label for="agb-checkbox">
                        Ich habe die <a href="agb.html" target="_blank" style="color: var(--brand); text-decoration: underline;">AGBs</a> gelesen und stimme ihnen zu.
                    </label>
                </div>

                <button id="register-btn" disabled>
                    <span class="btn-text">Konto erstellen</span>
                    <span class="btn-spinner"></span>
                </button>
                <div style="text-align: center; margin: 20px 0; color: #888;">ODER</div>
                <button id="google-register-btn" class="google-signin-btn">
                    <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google Logo">
                    Mit Google registrieren
                </button>
                <p class="toggle-link-text">Du hast bereits ein Konto? <a href="#" id="show-login">Hier anmelden</a></p>
            </div>

            <div id="google-username-view" style="display: none;">
                <h2>Noch ein Schritt</h2>
                <p class="modal-info-text">Willkommen! Bitte wähle einen Benutzernamen und bestätige die AGB, um deine Registrierung abzuschließen.</p>
                <input type="text" id="google-username-input" placeholder="Wähle einen Benutzernamen" maxlength="15" minlength="2">
                <div id="google-username-error-message" style="display: none; color: var(--error); text-align: left; font-size: 13px; margin-top: -10px; margin-bottom: 15px;"></div>
                <div style="text-align: left; margin-bottom: 20px; font-size: 13px; color: #666;">
                    <input type="checkbox" id="google-agb-checkbox" style="width: auto; margin-right: 8px; vertical-align: middle;">
                    <label for="google-agb-checkbox">
                        Ich habe die <a href="agb.html" target="_blank" style="color: var(--brand); text-decoration: underline;">AGBs</a> gelesen und stimme ihnen zu.
                    </label>
                </div>
                <button id="google-username-submit-btn" disabled>
                    <span class="btn-text">Registrierung abschließen</span>
                    <span class="btn-spinner"></span>
                </button>
                <br><small>Falls du die Registrierung nicht abschließen kannst, versuche deinen Benutzernamen erneut einzugeben.</small>
            </div>

            <div id="password-reset-view" style="display: none;">
                <div id="password-reset-initial-view">
                    <h2>Passwort zurücksetzen</h2>
                    <p class="modal-info-text">Gib deine E-Mail-Adresse ein. Wir senden dir einen Link, mit dem du dein Passwort zurücksetzen kannst.</p>
                    <input type="email" id="reset-email" placeholder="Deine E-Mail-Adresse" maxlength="50">
                    <button id="send-reset-email-btn">
                        <span class="btn-text">Link anfordern</span>
                        <span class="btn-spinner"></span>
                    </button>
                    <p class="toggle-link-text"><a href="#" id="back-to-login">Zurück zum Login</a></p>
                </div>
                <div id="password-reset-sent-view" class="styled-message-box" style="display: none; padding: 0;">
                    <i class="fa-solid fa-envelope-circle-check"></i>
                    <h2>E-Mail versendet!</h2>
                    <p>Eine E-Mail zum Zurücksetzen deines Passworts wurde an <strong id="reset-email-display"></strong> gesendet.</p>
                    <p><strong>Bitte schau auch in deinem Spam-Ordner nach!</strong></p>
                    <button id="resend-reset-email-btn" class="secondary-button" style="margin-top: 15px;" disabled>Erneut senden (60s)</button>
                    <p class="toggle-link-text" style="margin-top: 20px;"><a href="#" id="back-to-login-from-sent">Zurück zum Login</a></p>
                </div>
            </div>
            
            <div id="verification-message" class="styled-message-box" style="display: none;">
                <i class="fa-solid fa-envelope-circle-check"></i>
                <h2>Fast geschafft!</h2>
                <p>Eine Bestätigungs-E-Mail wurde an <strong id="verification-email-display"></strong> versendet. Bitte klicke auf den Link in der E-Mail, um dein Konto zu aktivieren.</p>
                <p><strong>Bitte schau auch in deinem Spam-Ordner nach!</strong></p>
                <button id="resend-verification-btn" class="secondary-button" style="margin-top: 15px;" disabled>Erneut senden (60s)</button>
                <p style="margin-top: 15px;">Danach kannst du dieses Fenster schließen und dich anmelden.</p>
            </div>
        </div>
    </div>
    
    <div id="reauth-delete-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="close-reauth-button">&times;</span>
            <h2>Bestätigung erforderlich</h2>
            <p class="modal-info-text">Um dein Konto endgültig zu löschen, gib bitte zur Sicherheit dein aktuelles Passwort ein.</p>
            <div class="password-wrapper">
                <input type="password" id="reauth-password" placeholder="Aktuelles Passwort">
                <i class="fa-solid fa-eye-slash" id="toggle-reauth-password"></i>
            </div>
            <button id="confirm-delete-btn" class="danger-button">
                <span class="btn-text">Konto endgültig löschen</span>
                <span class="btn-spinner"></span>
            </button>
        </div>
    </div>

    <div id="checkout-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="close-checkout-button">&times;</span>
            <div id="checkout-initial-view">
                <h2>Bestellung bestätigen</h2>
                
                <div class="checkout-summary-display">
                    <div class="checkout-summary-item">
                        <span>Abholtag:</span>
                        <strong><span id="checkout-pickup-day">--</span></strong>
                    </div>
                    <div class="checkout-summary-item">
                        <span>Abholzeit:</span>
                        <strong><span id="checkout-pickup-time">--:--</span> Uhr</strong>
                    </div>
                    <div class="checkout-summary-item" id="checkout-fee-row" style="font-size: 0.9em; font-weight: normal; display: none;">
                        <span>Transaktionsgebühr:</span>
                        <strong>0,25 €</strong>
                    </div>
                    <div class="checkout-summary-item">
                        <span>Gesamtpreis:</span>
                        <strong><span id="checkout-total-price">0,00 €</span></strong>
                    </div>
                </div>

                <div id="payment-request-button-container">
                </div>
                
                <button id="start-online-payment-btn" class="cta-button">
                    <i class="fa-solid fa-credit-card"></i>
                    <span class="btn-text">Online zahlen</span>
                    <span class="btn-spinner"></span>
                </button>
                <small class="modal-info-text" style="text-align: center; display: block; margin-top: 10px;">Der Bezahlvorgang kann wegen Server-Aufstartzeiten bis zu einer Minute dauern.</small>
                <div class="divider">ODER</div>
                <button id="pay-with-balance-btn" class="cta-button" style="background-color: var(--success);">
                    <i class="fa-solid fa-wallet"></i>
                    <span class="btn-text">
                        Mit Guthaben bezahlen
                       
                    </span>
                    
                    <span class="btn-spinner"></span>
                </button>
                 <small style="font-weight: 600; color: #fff;">(Keine Transaktionsgebühr, auch wenn sie oben angezeigt wird.)</small> 
                <br>
                <br>
                <div>
                    <button id="cancel-order-btn" class="secondary-button">Abbrechen</button>
                </div>
            </div>

            <div id="payment-element-container" style="display: none;">
                <button id="back-to-payment-options-btn" class="secondary-button">Andere Zahlungsmethode</button>
                <div id="payment-element">
                </div>
                <button id="submit-payment-btn" class="cta-button" style="margin-top: 20px;">
                    <span id="button-text">Jetzt bezahlen</span>
                    <span id="spinner" style="display: none;">Verarbeite...</span>
                </button>
                <div id="payment-message" class="cart-notice" style="display: none; margin-top: 15px;"></div>
            </div>
        </div>
    </div>

    <div id="reported-order-detail-modal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <span class="close-button">&times;</span>
            <h2>Gemeldete Bestellung</h2>
            <div id="reported-order-detail-content">
            </div>
        </div>
    </div>
    <a href="#cart-items-list" class="mobile-cart-link" id="mobile-cart-link">
        <i class="fa-solid fa-cart-shopping"></i>
        <span class="cart-bubble" id="mobile-cart-bubble">0</span>
    </a>
    <footer class="site-footer">
        <div class="footer-content">
            <div class="footer-section">
                <h4>Abholzeiten</h4>
                <p>Montag - Freitag: <br>11:20 - 14:00 Uhr</p>
            </div>
            <div class="footer-section">
                <h4>Support </h4>
                <p><a href="mailto:max.70050hi@gmail.com">max.70050hi@gmail.com</a></p>
            </div>
            <div class="footer-section">
                <h4>Rechtliches</h4>
                <p><a href="impressum.html">Impressum</a></p>
                <p><a href="datenschutz.html">Datenschutz</a></p>
                <p><a href="agb.html">AGB</a></p>
            </div>
        </div>

        <div id="cookie-banner" class="cookie-banner">
            <div class="cookie-banner-content">
                <p>
                    Wir verwenden technisch notwendige Cookies, um die Funktionalität dieser Webseite zu gewährleisten, beispielsweise um deinen Login-Status zu speichern. Weitere Informationen findest du in unserer <a href="datenschutz.html">Datenschutzerklärung</a>.
                </p>
                <div class="cookie-banner-actions">
                    <button id="cookie-accept-btn">Akzeptieren</button>
                </div>
            </div>
        </div>
    </footer>

    <script type="module" src="app.js"></script>
</body>


</html>


